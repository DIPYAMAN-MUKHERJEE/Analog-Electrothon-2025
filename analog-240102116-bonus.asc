Version 4
SHEET 1 880 824
WIRE -144 -512 -176 -512
WIRE 288 -496 224 -496
WIRE 288 -464 288 -496
WIRE -144 -416 -144 -432
WIRE 0 -416 -144 -416
WIRE -144 -400 -144 -416
WIRE 224 -384 224 -496
WIRE -256 -304 -256 -512
WIRE -144 -304 -144 -320
WIRE -144 -304 -256 -304
WIRE -256 -288 -256 -304
WIRE 224 -208 224 -304
WIRE 0 -192 0 -416
WIRE 192 -192 0 -192
WIRE 496 -176 256 -176
WIRE 192 -160 -192 -160
WIRE 688 -96 496 -96
WIRE 496 -80 496 -96
WIRE 224 0 224 -144
WIRE 496 0 224 0
WIRE 688 0 688 -32
WIRE 688 0 496 0
WIRE 224 16 224 0
WIRE -528 48 -640 48
WIRE -304 48 -448 48
WIRE -640 112 -640 48
WIRE 416 224 -144 224
WIRE 336 272 -16 272
WIRE -192 288 -192 -160
WIRE -144 288 -144 224
WIRE -144 288 -192 288
WIRE 336 320 336 272
WIRE -400 336 -624 336
WIRE 288 336 32 336
WIRE -144 352 -144 288
WIRE -112 352 -144 352
WIRE -16 352 -16 272
WIRE -16 352 -48 352
WIRE -1024 368 -1024 288
WIRE -400 368 -400 336
WIRE 288 384 112 384
WIRE -944 416 -944 288
WIRE -16 432 -16 352
WIRE 32 432 32 336
WIRE 32 432 -16 432
WIRE 336 464 336 400
WIRE 416 464 416 224
WIRE -624 480 -624 416
WIRE -656 496 -944 496
WIRE -304 496 -304 48
WIRE -304 496 -480 496
WIRE -16 496 -16 432
WIRE -496 512 -592 512
WIRE -144 512 -144 352
WIRE -144 512 -336 512
WIRE -944 528 -944 496
WIRE -656 528 -720 528
WIRE 112 528 112 384
WIRE -336 544 -336 512
WIRE -384 560 -448 560
WIRE -448 576 -448 560
WIRE -496 608 -496 512
WIRE -480 608 -480 496
WIRE -384 608 -480 608
WIRE -944 656 -944 608
WIRE -720 672 -720 528
WIRE -720 672 -864 672
WIRE 112 688 112 608
WIRE -624 704 -624 544
WIRE -496 704 -496 608
WIRE -336 704 -496 704
WIRE -864 784 -864 752
FLAG -1024 368 0
FLAG -400 368 0
FLAG -624 704 0
FLAG -864 784 0
FLAG -16 496 0
FLAG -448 576 0
FLAG 112 688 0
FLAG -496 608 out
FLAG -144 352 c1
FLAG -640 112 0
FLAG 224 16 0
FLAG 288 -464 0
FLAG -256 -288 0
FLAG -944 656 0
SYMBOL cap -112 368 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 61 85 Invisible 2
SYMATTR InstName C1
SYMATTR Value 10µ
SYMATTR SpiceLine IC=0
SYMBOL voltage -624 432 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 12
SYMBOL voltage -928 288 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 12
SYMBOL OpAmps\\LT1002 -624 448 R0
SYMATTR InstName U1
SYMBOL sw 336 304 R0
SYMATTR InstName S1
SYMBOL bv 112 512 R0
SYMATTR InstName B1
SYMATTR Value V=  if ((V(out)<1.2) ,5,0)
SYMBOL res -352 608 R0
SYMATTR InstName R1
SYMATTR Value {rload}
SYMBOL res 432 448 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1000K
SYMBOL sw -336 528 R0
SYMATTR InstName S2
SYMBOL bv -432 48 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName B2
SYMATTR Value V= if(V(out)>1.2,5,0)
SYMBOL voltage -864 656 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value PULSE(0 20 0 0 0 0.15)
SYMBOL OpAmps\\LT1002 224 -240 R0
SYMATTR InstName U2
SYMBOL voltage 224 -288 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 12
SYMBOL voltage -160 -512 R90
WINDOW 0 -32 56 VBottom 2
WINDOW 3 32 56 VTop 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 12
SYMBOL res -160 -528 R0
SYMATTR InstName R3
SYMATTR Value 2
SYMBOL res -160 -416 R0
SYMATTR InstName R4
SYMATTR Value 10
SYMBOL res -960 400 R0
SYMATTR InstName R5
SYMATTR Value 7
SYMBOL res -960 512 R0
SYMATTR InstName R6
SYMATTR Value 5
SYMBOL res 480 -192 R0
SYMATTR InstName R7
SYMATTR Value 10k
SYMBOL res 480 -96 R0
SYMATTR InstName R8
SYMATTR Value 2k
SYMBOL diode 672 -96 R0
SYMATTR InstName D1
TEXT -1024 472 Left 0 ;reference voltage
TEXT -728 360 Left 0 ;offset voltage
TEXT -1024 808 Left 2 !.tran 5
TEXT -440 760 Left 2 !.model sw sw()
TEXT 112 200 Left 2 ;this portion is for the discharge of the capacitor
TEXT -336 728 Left 2 !.step param rload 6k 20k 2.5k
